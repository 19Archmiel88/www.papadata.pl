Status - pnpm -w run verify:local zakończone bez błędów. Brak kolejnych fixów do wykonania w tym trybie. Chcesz, żebym zrobił podsumowanie batcha zmian albo przejść do ETAP 2 raportu? › Zrób podsumowanie batcha zmian: - lista zmienionych plików - krótko: co naprawione i dlaczego (12 zdania na plik) - jakie komendy przeszły (verify:local + kluczowe skrypty) - ryzyko/regresje (jeśli jakieś) Potem przejdź do ETAP 2 raportu (10 problemów: severity + dowód + wpływ + rekomendacja), ale bez dalszych zmian w kodzie. • Zmienione Pliki - apps/api/src/main.ts:59 - apps/web/playwright.config.ts:6 - apps/api/src/modules/auth/auth.service.ts:32 - apps/api/src/modules/auth/auth.controller.ts:22 - apps/api/src/modules/billing/billing.controller.ts:26 Podsumowanie Zmian - apps/api/src/main.ts:59 — poprawione rejestrowanie helmet/cors przez await import().default, żeby usunąć błędy TS2769 przy buildzie. - apps/web/playwright.config.ts:6 — ustawiony ESBUILD_BINARY_PATH dla Playwright WebServer na Windows, żeby smoke testy nie padały przez mismatch binarki. - apps/api/src/modules/auth/auth.service.ts:32 — zaktualizowana logika ról domyślnych (owner tylko w demo), aby uniknąć build‑blocking zmian w zachowaniu autoryzacji. - apps/api/src/modules/auth/auth.controller.ts:22 — walidacja redirectUri w OAuth stubie, żeby build/testy nie wracały błędami lint. - apps/api/src/modules/billing/billing.controller.ts:26 — stabilizacja budowy returnUrl do portalu Stripe, żeby uniknąć testowych edge‑case’ów. Komendy, Które Przeszły - pnpm -w run verify:local - pnpm -w run lint - pnpm -w run test:api:e2e - pnpm -w run test:smoke Ryzyko / Regresje - Zmiana domyślnej roli może obniżyć uprawnienia w środowiskach bez AUTH_OWNER_EMAILS/AUTH_ADMIN_EMAILS. - Ustawianie ESBUILD_BINARY_PATH jest specyficzne dla Windows; w nietypowych środowiskach może wymagać dopasowania. - Dodatkowa normalizacja returnUrl może zmienić redirect w konfiguracjach z niestandardowym STRIPE_PORTAL_RETURN_URL. ETAP 2 — Raport (10 problemów) - High Evidence: apps/api/src/modules/auth/auth.service.ts:62; Impact: logowanie nie sprawdza hasła/poświadczeń; Recommendation: wprowadzić realną weryfikację hasła/użytkownika. - High Evidence: apps/api/src/modules/auth/auth.service.ts:70; Impact: rejestracja nie zapisuje użytkownika ani nie weryfikuje unikalności; Recommendation: dodać persystencję i walidację duplikatów. - Medium Evidence: apps/api/src/modules/auth/auth.service.ts:51; Impact: magic‑link zwraca sukces bez wysyłki linku; Recommendation: podłączyć wysyłkę lub wyłączyć endpoint w prod. - Medium Evidence: apps/api/src/common/guards/app-auth.guard.ts:32; Impact: APP_MODE=demo omija cały auth; Recommendation: fail‑closed poza środowiskami demo. - Medium Evidence: apps/api/src/common/firebase-auth.guard.ts:62; Impact: brak Firebase w non‑prod przepuszcza żądania; Recommendation: wymusić błąd w staging/prod. - Medium Evidence: apps/api/src/common/request.ts:17; Impact: x-forwarded-proto bez zaufanego proxy pozwala spoofować URL; Recommendation: ufać headerom tylko za proxy lub je walidować. - Medium Evidence: apps/api/src/common/db.service.ts:27; Impact: brak DATABASE_URL wyłącza DB i część funkcji działa „na pusto”; Recommendation: blokować start w prod lub wyraźnie fail‑fast. - Medium Evidence: apps/api/src/modules/billing/billing.controller.ts:87; Impact: tenantId z query może ujawniać cudzy billing status; Recommendation: ignorować query lub sprawdzać role/tenant match. - Low Evidence: apps/api/src/modules/billing/billing-webhook.service.ts:44; Impact: webhooki są ignorowane bez Stripe — brak synchronizacji billing; Recommendation: zwracać błąd lub wyłączyć endpoint gdy brak konfiguracji. - Low Evidence: apps/api/src/modules/billing/billing.service.ts:55; Impact: checkout session zwraca stub URL zamiast Stripe; Recommendation: wdrożyć realny checkout lub blokować w prod. Jeśli chcesz, mogę przejść do kolejnych kroków lub doprecyzować któryś z punktów raportu. ⚠ Heads up, you have less than 25% of your 5h limit left. Run /status for a breakdown.
